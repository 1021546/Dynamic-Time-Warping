
clear;
clear global;

% 取得測試音檔的特徵向量
fileName = 'wav/w1_0.wav';
[epd_y, fs, epd_start, epd_end, y] = my_epd(fileName);
feature_mfcc = my_mfcc(epd_y, fs);
[feature_size, frame_num] = size(feature_mfcc);

% % 檢查端點 ------------------------------------------------------------
% x = 1:length(y);
% plot(x, y);
% title('Wave Form'); 
% line([epd_start epd_start], [min(y) max(y)], 'color', 'r');
% line([epd_end epd_end], [min(y) max(y)], 'color', 'g');
% -------------------------------------------------------------------

template_num = 6;
dtw_distance(template_num) = 0;

for i = 1:template_num

	% _t表示template
	clear fileName_t epd_y_t fs_t feature_mfcc_t feature_size_t frame_num_t dtw_grid;

	% 取得template音檔的特徵向量
	fileName_t = strcat(strcat('wav/w0_',num2str(i-1)),'.wav');
	[epd_y_t, fs_t] = my_epd(fileName_t);
	feature_mfcc_t = my_mfcc(epd_y_t, fs_t);
	[feature_size_t, frame_num_t] = size(feature_mfcc_t);

	% 建立dtw表格
	dtw_grid(frame_num, frame_num_t) = 0;
	
	for j = 1:frame_num
		for k = 1:frame_num_t
			for l = 1:feature_size
				dtw_grid(j, k) = dtw_grid(j, k) + (feature_mfcc(l, j)-feature_mfcc_t(l, k))^2;
			end
			dtw_grid(j, k) = sqrt(dtw_grid(j, k));
		end
	end

	% 作法一: 遞迴
	clear global;
	global dtw_grid2
	dtw_grid2(frame_num, frame_num_t) = 0; %累積的
	dtw_distance(i) = dtw_grid_c(dtw_grid, frame_num, frame_num_t);

	% 作法二: 迴圈
	% http://www.cnblogs.com/Daringoo/p/4095508.html
	% dtw_grid2(frame_num,frame_num_t) = 0;
	% for j = 1:frame_num
	% 	for k = 1:frame_num_t
	% 		if (j==1) && (k==1)
	% 			dtw_grid2(j,k) = dtw_grid(j,k);
	% 			continue;
	% 		end
	% 		if (j>1) && (k>1)
	% 			temp1 = dtw_grid2(j-1,k-1);
	% 		else
	% 			temp1 = realmax;
	% 		end
	% 		if j>1
	% 			temp2 = dtw_grid2(j-1,k);
	% 		else
	% 			temp2 = realmax;
	% 		end
	% 		if k>1 
	% 			temp3 = dtw_grid2(j,k-1);
	% 		else
	% 			temp3 = realmax;
	% 		end
	% 		dtw_grid2(j,k) = dtw_grid(j,k) + min([temp1,temp2,temp3]);
	% 	end
	% end
	
	dtw_distance(i) = dtw_grid2(frame_num,frame_num_t);

end

% adasd = [4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3];
% adasd = [4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3; 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2 4 10 1 6 2; 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7 8 2 9 4 7; 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5 7 5 7 1 5; 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4 0 3 4 5 4; 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3 23 13 13 0 3];
% adasd2(20, 20) = 0;
% temp = dtw_grid_c(adasd, adasd2, 20, 20);

dtw_distance
[min_distance, min_distance_index] = min(dtw_distance);
disp(['最接近:w1_', num2str(min_distance_index-1), '.wav 距離為:', num2str(min_distance)]);
